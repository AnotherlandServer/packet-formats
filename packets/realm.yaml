# yaml-language-server: $schema=../otherland.packet.schema.yaml

packets:  
  oaPktSendMsgToRealm:
    id: 0x7e
    subId: 0x0d
    inherit: CPkt
    description: >
      Debug messages generated by the client and sent to the server.
      Probably used to debug issues during character selection.
      See https://www.reddit.com/r/Otherland/comments/3o8nof/state_of_the_game_no3
    fields:
      - name: message
        type: cstring
  oaPktRealmSelect:
    id: 0xa4
    subId: 0x01
    inherit: CPkt
    description: >
      Sent as the result of selecting a realm and channel.
      Might not be entirely functional, as I have not found a way of 
      transmitting the realm ip and port for the client to connect to
      after selecting it.
    relatesTo:
      - oaPktRealmStatusList
    fields:
      - type: i32
        name: realmId
      - type: i32
        name: channelId
  oaPktRealmStatusList:
    id: 0xa4
    subId: 0x00
    inherit: CPkt
    description: >
      A list of realms displayed to the user.
    relatesTo:
      - oaPktRealmSelect
    fields:
      - name: realmCount
        type: u32
      - type: { name: array, len: realmCount, type: :RealmStatus }
        name: realms
structures:
  RealmStatus:
    description: >
      An entry representing a single realm. The arrays `channelId` and `channelPopulation`
      are expected to have the same length, together rendering the realms channel list.
      The client seems to duplicate the realm entry per channel. At least one channel
      is expected to be given.
    fields:
      - name: id
        type: i32
      - name: name
        type: cstring
      - name: channelCount
        type: u32
      - type: { name: array, len: channelCount, type: u32 }
        name: channelId
      - name: channelPopulationCount
        type: u32
      - type: { name: array, len: channelPopulationCount, type: f32 }
        name: channelPopulation
        description: >
          Amount of sessions/players logged in to this channel.